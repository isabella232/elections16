{% extends '_card_base.html' %}

{% block card_content %}
<header>
    {% if state == 'during' or state == 'before' %}
    <h2>Current Status</h2>
    {% else %}
    <h2>The Results Are In</h2>
    {% endif %}

    <h1>{{ party }} Results</h1>
</header>

<article>
    <ul class="meta">
        <li>
            As of {{ last_updated|ap_date }}, {{ last_updated|ap_time }} <span class="ap-period">{{ last_updated|ap_time_period }}</span> EST
            <span class="update-indicator"></span>
        </li>
    </ul>

    {% for race in races %}
    {% if race.precinctsreporting > 0 %}
    <div class="state-result" data-state="{{ race.statename }}">
        <div class="condensed">
            <!-- full name on desktop / ap abbr on mobile -->
            <h2><span class="desktop">{{ race.statename }}</span><span class="mobile">{{ race.statepostal|ap_state }}</span></h2>
            <!-- if total votes > 0 -->
            <div class="top-votes">
                <table>
                    {% for result in race.results[:2] %}
                    <tr {% if (result.winner and result.call[0].accept_ap) or (result.call[0].override_winner and not result.call[0].accept_ap) %} class="winner" {% endif %}>
                        <td>{{ result.last }} {% if (result.winner and result.call[0].accept_ap) or (result.call[0].override_winner and not result.call[0].accept_ap) %}<b class="icon icon-check"></b> {% endif %}</td>
                        <td class="pct">{{ result.votepct|normalize_percent|percent }}</td>
                    </tr>
                    {% endfor %}
                </table>
            </div>
            <ul class="meta">
                <li>{{ race.precinctsreportingpct|percent }} <span class="desktop">precincts</span><span class="mobile">in</span></li>
            </ul>
            <div class="arrow"><b class="icon-right-open"></b></div>
        </div>

        <div class="expanded">
            <h2>{{ race.statename }} primary <b class="icon-down-open"></b></h2>
            <ul class="meta">
                <li>{{ race.precinctsreportingpct|percent }} of precincts reporting ({{ race.precinctsreporting }} of {{ race.precinctstotal }})</li>
            </ul>
            <table>
                <thead>
                    <tr>
                        <th>Name</th>
                        <th class="votes">Votes</th>
                        <th class="pct">Percent</th>
                    </tr>
                </thead>
                <tbody>
                    {% for result in race.results %}
                    <tr {% if (result.winner and result.call[0].accept_ap) or (result.call[0].override_winner and not result.call[0].accept_ap) %} class="winner" {% endif %}>
                        <td>{{ result.first }} {{ result.last }} {% if (result.winner and result.call[0].accept_ap) or (result.call[0].override_winner and not result.call[0].accept_ap) %}<b class="icon icon-check"></b> {% endif %}</td>
                        <td class="votes">{{ result.votecount|comma }}</td>
                        <td class="pct">{{ result.votepct|normalize_percent|percent }}</td>
                    </tr>
                    {% endfor %}
                    <tr>
                        <td>Other</td>
                        <td class="votes">{{ race.other_votecount|comma }}</td>
                        <td class="pct">{{ race.other_votepct|normalize_percent|percent }}</td>
                    </tr>
                </tbody>
                <tfoot>
                    <tr class="total">
                        <td>Total</td>
                        <td class="votes">{{ race.total|comma }}</td>
                        <td class="pct">100.0%</td>
                    </tr>
                </tfoot>
            </table>
        </div>
    </div>
    {% endif %}
    {% endfor %}
    <dl class="poll-info">
        {% for closing, states in poll_closings.iteritems() %}
        {% if states|length > 0 %}
        <dt>Polls close at {{ closing }} EDT</dt>
        {% for state in states %}
        <dd>{{ state }}</dd>
        {% endfor %}
        {% endif %}
        {% endfor %}
    </dl>

    <ul class="meta">
        <li class="footnote">
            Colorado and Wyoming's Republican parties also hold caucuses today,
            but neither will have a presidential preference vote and no
            delegates will be awarded. AP is not reporting live results.
        </li>
        <li>Source: AP</li>
    </ul>
</article>

{% endblock %}
